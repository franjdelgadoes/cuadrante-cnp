<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuadrante CNP v4.2</title>
    
    <style>
        :root {
            --primary: #1e3a8a; /* Azul CNP m√°s intenso */
            --secondary: #334155; --accent: #2563eb; --bg: #f1f5f9; --text: #1e293b;
            /* COLORES TURNOS */
            --t-m: #fef9c3; --t-m-text: #854d0e;
            --t-t: #ffedd5; --t-t-text: #9a3412;
            --t-n: #dbeafe; --t-n-text: #1e40af;
            --t-s: #e2e8f0; --t-s-text: #64748b;
            --t-l: #ffffff; --t-l-text: #10b981;
            
            /* COLORES EVENTOS */
            --evt-juicio: #ef4444;       --evt-vacaciones: #15803d;   --evt-vac-ant: #86efac;
            --evt-ap: #9333ea;           --evt-ap-ant: #d8b4fe;       --evt-comp: #f59e0b;
            --evt-navidad: #b45309;      --evt-ssanta: #7e22ce;       --evt-baja: #374151;
            --evt-nota: #0ea5e9;         --evt-otros: #db2777;
        }

        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 80px; }
        
        /* HEADER */
        .header { background: var(--primary); color: white; padding: 15px 20px; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 1.1rem; font-weight: 700; letter-spacing: 0.5px; }
        .header-controls { display: flex; gap: 10px; }

        .container { max-width: 800px; margin: 20px auto; padding: 0 15px; }

        /* CARDS */
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .control-row { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 15px; }
        .control-group { flex: 1; min-width: 150px; }
        label { display: block; font-size: 0.8rem; font-weight: 600; color: var(--secondary); margin-bottom: 5px; }
        select, input, button { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #cbd5e1; font-size: 0.95rem; box-sizing: border-box; }
        
        button { font-weight: 600; cursor: pointer; transition: 0.2s; border: none; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-sec { background: var(--secondary); color: white; }
        .btn-backup { background: #059669; color: white; font-size: 0.8rem; padding: 5px 10px; }
        .btn-restore { background: #d97706; color: white; font-size: 0.8rem; padding: 5px 10px; }
        .btn-danger { background: #ef4444; color: white; }

        /* CALENDARIO */
        .calendar-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .month-card { background: white; border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; }
        .month-header { background: var(--secondary); color: white; padding: 8px; text-align: center; font-weight: 700; font-size: 0.9rem; text-transform: uppercase; }
        .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); padding: 5px; gap: 2px; }
        .day-name { text-align: center; font-size: 0.75rem; color: #94a3b8; font-weight: bold; padding: 5px 0; }
        
        .day-cell {
            aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 6px; font-size: 0.9rem; cursor: pointer; position: relative; overflow: hidden;
            border: 1px solid transparent; transition: transform 0.1s;
        }
        .day-num { font-weight: 700; z-index: 2; }
        .day-info { font-size: 0.65rem; z-index: 2; text-align: center; line-height: 1; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* COLORES */
        .t-M { background: var(--t-m); color: var(--t-m-text); }
        .t-T { background: var(--t-t); color: var(--t-t-text); }
        .t-N { background: var(--t-n); color: var(--t-n-text); }
        .t-S { background: var(--t-s); color: var(--t-s-text); font-style: italic; }
        .t-L { background: var(--t-l); color: var(--t-l-text); border-color: #f1f5f9; }

        .evt-JUICIO { background: var(--evt-juicio); color: white; }
        .evt-VACACIONES { background: var(--evt-vacaciones); color: white; }
        .evt-VAC_ANT { background: var(--evt-vac-ant); color: #064e3b; }
        .evt-COMPENSACION { background: var(--evt-comp); color: white; }
        .evt-AP { background: var(--evt-ap); color: white; }
        .evt-AP_ANT { background: var(--evt-ap-ant); color: #581c87; }
        .evt-NAVIDAD { background: var(--evt-navidad); color: white; }
        .evt-SSANTA { background: var(--evt-ssanta); color: white; }
        .evt-BAJA { background: var(--evt-baja); color: white; }
        .evt-NOTA { background: var(--evt-nota); color: white; }
        .evt-OTROS { background: var(--evt-otros); color: white; }

        /* UI ELEMENTS */
        #customPatternBox { background: #eff6ff; padding: 15px; border-radius: 8px; border: 1px solid #bfdbfe; margin-top: 10px; display: none; }
        .fab-stats { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; z-index: 90; }
        #statsPanel { display: none; padding: 15px; background: #f1f5f9; border-radius: 8px; margin-bottom: 20px; font-size: 0.85rem; }
        .stat-tag { display: inline-block; padding: 3px 8px; border-radius: 4px; margin: 2px; color: white; font-weight: bold; font-size: 0.75rem; }
        #errorBox { display: none; background: #fee2e2; border: 1px solid #ef4444; color: #991b1b; padding: 15px; margin-bottom: 20px; border-radius: 8px; }

        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 200; display: none; justify-content: center; align-items: end; }
        .modal { background: white; width: 100%; max-width: 500px; border-radius: 20px 20px 0 0; padding: 25px; box-shadow: 0 -5px 25px rgba(0,0,0,0.2); animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; }
        .hidden { display: none; }

        /* Campos Modal */
        .modal-field-group { margin-bottom: 10px; }
        .modal-field-group label { color: #64748b; font-size: 0.75rem; }

    </style>
</head>
<body>

<div class="header">
    <div style="display: flex; align-items: center; gap: 12px;">
        <img src="data:image/png;base64,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" 
             style="height: 45px; width: auto;" 
             alt="Logo CNP">
             
        <h1>Cuadrante CNP</h1>
    </div>

    <div class="header-controls">
        <button class="btn-backup" onclick="app.exportData()">üíæ</button>
        <button class="btn-restore" onclick="document.getElementById('fileInput').click()">üìÇ</button>
        <input type="file" id="fileInput" style="display: none" onchange="app.importData(this)" accept=".json">
    </div>
</div>
<div class="container">
    <div id="errorBox"></div>

    <div class="card">
        <div class="control-row">
            <div class="control-group">
                <label>Patr√≥n de Turno:</label>
                <select id="patternSelect" onchange="app.handlePatternChange()">
                    <option value="6x6">6x6</option>
                    <option value="3x3">3x3</option>
                    <option value="2x4">2x4</option>
                    <option value="7x7">7x7</option>
                    <option value="LV_M">L-V Ma√±ana (Finde L)</option>
                    <option value="LV_ROT">L-V Rotativo (Sem M/T)</option>
                    <option value="CUSTOM">‚öôÔ∏è Personalizado</option>
                </select>
            </div>
            <div class="control-group">
                <label>Inicio Ciclo:</label>
                <input type="date" id="startDate" onchange="app.render()">
            </div>
        </div>

        <div id="customPatternBox">
            <label>Secuencia Personalizada (ej: M M L L N S):</label>
            <div style="display:flex; gap:10px;">
                <input type="text" id="customInput" style="text-transform: uppercase;">
                <button class="btn-primary" style="width: auto;" onclick="app.saveCustomPattern()">Aplicar</button>
            </div>
        </div>
    </div>

    <div id="statsPanel"></div>
    <div id="calendarContainer" class="calendar-grid"></div>

    <div style="text-align: center; margin-top: 50px; opacity: 0.4;">
        <button onclick="app.factoryReset()" style="background: none; color: #94a3b8; font-size: 0.7rem;">‚ö†Ô∏è Reset Completo</button>
    </div>
</div>

<div class="fab-stats" onclick="app.toggleStats()">üìä</div>

<div class="modal-overlay" id="modalOverlay" onclick="if(event.target === this) app.closeModal()">
    <div class="modal">
        <div class="modal-header">
            <div style="font-size:1.2rem; font-weight:bold; color:var(--primary)" id="modalTitle">Fecha</div>
            <button onclick="app.closeModal()" style="width:auto; background:none; font-size:1.5rem;">&times;</button>
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <div class="modal-field-group">
                <label>Tipo de Incidencia / Permiso:</label>
                <select id="evtType" onchange="app.toggleModalFields()">
                    <option value="">-- Turno Calculado (Restablecer) --</option>
                    <option value="JUICIO">‚öñÔ∏è Juicio</option>
                    <option value="NOTA">üìù Nota Personal</option>
                    <option disabled>--- Permisos ---</option>
                    <option value="AP">üü£ Asuntos Propios</option>
                    <option value="AP_ANT">üü£ AP (A√±o Anterior)</option>
                    <option value="COMPENSACION">üü† Compensaci√≥n Horaria</option>
                    <option value="NAVIDAD">üéÑ Permiso Navidad</option>
                    <option value="SSANTA">‚úùÔ∏è Permiso Semana Santa</option>
                    <option value="OTROS">üéóÔ∏è Perm./Lic.</option>
                    <option disabled>--- Vacaciones/Bajas ---</option>
                    <option value="VACACIONES">üå¥ Vacaciones</option>
                    <option value="VAC_ANT">üå¥ Vacaciones (A√±o Ant)</option>
                    <option value="BAJA">üè• Baja M√©dica</option>
                </select>
            </div>

            <div id="fieldsJuicio" class="hidden">
                <div class="control-row">
                    <div class="control-group">
                        <label>Hora:</label>
                        <input type="time" id="evtTime">
                    </div>
                    <div class="control-group">
                        <label>Juzgado:</label>
                        <input type="text" id="evtCourt" placeholder="Ej: Instrucci√≥n 5">
                    </div>
                </div>
                <div class="modal-field-group">
                    <label>Procedimiento / Atestado:</label>
                    <input type="text" id="evtCase" placeholder="Ej: DP 123/2024">
                </div>
            </div>

            <div id="fieldsCommon" class="hidden">
                <label>Observaciones:</label>
                <input type="text" id="evtNote" placeholder="Anotaciones...">
            </div>

            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button class="btn-danger" onclick="app.deleteEvent()">Borrar</button>
                <button class="btn-primary" onclick="app.saveEvent()">Guardar</button>
            </div>
        </div>
    </div>
</div>

<script>
window.onerror = function(msg, url, line) {
    document.getElementById('errorBox').style.display = 'block';
    document.getElementById('errorBox').innerHTML = `<strong>Error:</strong> ${msg} (${line})`;
    return false;
};

window.app = {
    data: {
        config: { pattern: '6x6', startDate: '', customSeq: [] },
        events: {} 
    },
    patterns: {
        '6x6': ['M','M','T','T','N','N','S','L','L','L','L','L'],
        '3x3': ['M','M','M','L','L','L','T','T','T','L','L','L'],
        '2x4': ['N','N','S','L','L','L'],
        '7x7': ['M','M','M','M','M','M','M', 'L','L','L','L','L','L','L', 'T','T','T','T','T','T','T', 'L','L','L','L','L','L','L'],
        'LV_M': ['M','M','M','M','M','L','L'],
        'LV_ROT': ['M','M','M','M','M','L','L', 'T','T','T','T','T','L','L']
    },
    labels: {
        'JUICIO': 'Juicio', 'VACACIONES': 'Vacac.', 'VAC_ANT': 'Vac.Ant',
        'AP': 'AP', 'AP_ANT': 'AP Ant', 'COMPENSACION': 'Comp.',
        'NAVIDAD': 'Navidad', 'SSANTA': 'S.Santa', 'BAJA': 'Baja',
        'NOTA': 'Nota', 'OTROS': 'Perm/Lic'
    },
    currentDate: null,

    init: function() {
        try {
            const storedCfg = localStorage.getItem('policeAppConfig_v4');
            const storedEvts = localStorage.getItem('policeAppEvents_v4');
            if (storedCfg) this.data.config = JSON.parse(storedCfg);
            if (storedEvts) this.data.events = JSON.parse(storedEvts);

            const picker = document.getElementById('startDate');
            if(this.data.config.startDate) picker.value = this.data.config.startDate;
            else picker.valueAsDate = new Date();

            document.getElementById('patternSelect').value = this.data.config.pattern || '6x6';
            if(this.data.config.pattern === 'CUSTOM') {
                document.getElementById('customPatternBox').style.display = 'block';
                document.getElementById('customInput').value = (this.data.config.customSeq || []).join(' ');
            }
            this.render();
        } catch (e) { alert("Error init: " + e.message); }
    },

    render: function() {
        try {
            const container = document.getElementById('calendarContainer');
            container.innerHTML = '';
            
            const patternKey = document.getElementById('patternSelect').value;
            const startDateStr = document.getElementById('startDate').value;
            this.data.config.pattern = patternKey;
            this.data.config.startDate = startDateStr;
            localStorage.setItem('policeAppConfig_v4', JSON.stringify(this.data.config));

            if (!startDateStr) return;

            let sequence = (patternKey === 'CUSTOM') ? (this.data.config.customSeq || ['L']) : this.patterns[patternKey];
            const startDt = new Date(startDateStr);
            const today = new Date();
            let loopDate = new Date(today.getFullYear(), today.getMonth(), 1);
            
            // CAMBIO AQU√ç: De 12 a 60 (5 A√±os)
            for(let i=0; i<60; i++) {
                container.appendChild(this.createMonth(loopDate.getFullYear(), loopDate.getMonth(), startDt, sequence));
                loopDate.setMonth(loopDate.getMonth() + 1);
            }
            this.renderStats();
        } catch (e) { alert("Error render: " + e.message); }
    },

    createMonth: function(year, month, startDt, sequence) {
        const names = ["ENE", "FEB", "MAR", "ABR", "MAY", "JUN", "JUL", "AGO", "SEP", "OCT", "NOV", "DIC"];
        const card = document.createElement('div');
        card.className = 'month-card';
        card.innerHTML = `<div class="month-header">${names[month]} ${year}</div>`;
        const grid = document.createElement('div');
        grid.className = 'days-grid';
        ['L','M','X','J','V','S','D'].forEach(d => grid.innerHTML += `<div class="day-name">${d}</div>`);
        
        const firstDay = new Date(year, month, 1);
        let startDay = firstDay.getDay() === 0 ? 7 : firstDay.getDay();
        for(let i=1; i<startDay; i++) grid.appendChild(document.createElement('div'));

        const daysInMonth = new Date(year, month + 1, 0).getDate();
        for (let d = 1; d <= daysInMonth; d++) {
            const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const cell = document.createElement('div');
            cell.className = 'day-cell';
            cell.onclick = function() { window.app.openModal(dateStr); };

            if (this.data.events[dateStr]) {
                const evt = this.data.events[dateStr];
                cell.classList.add(`evt-${evt.type}`);
                let txt = this.labels[evt.type] || evt.type;
                if(evt.type==='JUICIO' && evt.time) txt = evt.time;
                cell.innerHTML = `<div class="day-num">${d}</div><div class="day-info">${txt}</div>`;
            } else {
                const curr = new Date(year, month, d);
                const diff = Math.floor((curr - startDt) / 86400000);
                if (diff >= 0) {
                    const code = sequence[diff % sequence.length];
                    cell.classList.add(`t-${code}`);
                    cell.innerHTML = `<div class="day-num">${d}</div><div class="day-info">${code}</div>`;
                } else {
                    cell.innerHTML = `<div class="day-num">${d}</div>`;
                    cell.style.opacity = 0.3;
                }
            }
            grid.appendChild(cell);
        }
        card.appendChild(grid);
        return card;
    },

    // UI HANDLERS
    handlePatternChange: function() {
        const val = document.getElementById('patternSelect').value;
        document.getElementById('customPatternBox').style.display = (val === 'CUSTOM') ? 'block' : 'none';
        if(val !== 'CUSTOM') this.render();
    },
    saveCustomPattern: function() {
        const raw = document.getElementById('customInput').value.toUpperCase();
        const seq = raw.split(/[\s,]+/).filter(x => x);
        if(!seq.length) return alert("Secuencia vac√≠a");
        this.data.config.customSeq = seq;
        this.render();
    },
    
    // MODAL
    openModal: function(d) {
        this.currentDate = d;
        document.getElementById('modalOverlay').style.display = 'flex';
        document.getElementById('modalTitle').innerText = d;
        
        // Reset
        document.getElementById('evtType').value = "";
        ['evtTime','evtCourt','evtCase','evtNote'].forEach(id => document.getElementById(id).value = "");
        
        if(this.data.events[d]) {
            const e = this.data.events[d];
            document.getElementById('evtType').value = e.type;
            document.getElementById('evtTime').value = e.time||"";
            document.getElementById('evtCourt').value = e.court||"";
            document.getElementById('evtCase').value = e.case||"";
            document.getElementById('evtNote').value = e.note||"";
        }
        this.toggleModalFields();
    },
    toggleModalFields: function() {
        const t = document.getElementById('evtType').value;
        const fJuicio = document.getElementById('fieldsJuicio');
        const fCommon = document.getElementById('fieldsCommon');
        
        if (!t) {
            fJuicio.classList.add('hidden');
            fCommon.classList.add('hidden');
            return;
        }

        fCommon.classList.remove('hidden'); 

        if (t === 'JUICIO') {
            fJuicio.classList.remove('hidden');
        } else {
            fJuicio.classList.add('hidden');
        }
    },
    closeModal: function() { document.getElementById('modalOverlay').style.display = 'none'; },
    saveEvent: function() {
        const t = document.getElementById('evtType').value;
        if(!t) return this.deleteEvent();
        
        this.data.events[this.currentDate] = {
            type: t,
            time: document.getElementById('evtTime').value,
            court: document.getElementById('evtCourt').value,
            case: document.getElementById('evtCase').value,
            note: document.getElementById('evtNote').value
        };
        localStorage.setItem('policeAppEvents_v4', JSON.stringify(this.data.events));
        this.closeModal(); this.render();
    },
    deleteEvent: function() {
        delete this.data.events[this.currentDate];
        localStorage.setItem('policeAppEvents_v4', JSON.stringify(this.data.events));
        this.closeModal(); this.render();
    },

    // TOOLS
    toggleStats: function() {
        const p = document.getElementById('statsPanel');
        p.style.display = p.style.display==='block' ? 'none' : 'block';
    },
    renderStats: function() {
        const y = new Date().getFullYear();
        const c = {};
        Object.keys(this.data.events).forEach(d => {
            if(d.startsWith(y)) {
                const t = this.data.events[d].type;
                c[t] = (c[t]||0) + 1;
            }
        });
        let h = `<strong>Resumen ${y}:</strong><br>`;
        Object.keys(c).forEach(k => h+=`<span class="stat-tag" style="background:#334155">${this.labels[k]||k}: ${c[k]}</span> `);
        document.getElementById('statsPanel').innerHTML = h;
    },
    exportData: function() {
        const d = JSON.stringify(this.data);
        const b = new Blob([d],{type:"application/json"});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(b); a.download = "backup_cuadrante.json";
        document.body.appendChild(a); a.click(); a.remove();
    },
    importData: function(i) {
        const f = i.files[0]; if(!f) return;
        const r = new FileReader();
        r.onload = e => {
            try {
                const d = JSON.parse(e.target.result);
                if(d.config && d.events) {
                    localStorage.setItem('policeAppConfig_v4', JSON.stringify(d.config));
                    localStorage.setItem('policeAppEvents_v4', JSON.stringify(d.events));
                    location.reload();
                } else alert("Archivo inv√°lido");
            } catch(x) { alert("Error import"); }
        };
        r.readAsText(f);
    },
    factoryReset: function() {
        if(confirm("SE BORRAR√ÅN TODOS LOS DATOS. ¬øCONTINUAR?")) {
            localStorage.removeItem('policeAppConfig_v4');
            localStorage.removeItem('policeAppEvents_v4');
            location.reload();
        }
    }
};

document.addEventListener('DOMContentLoaded', () => { window.app.init(); });
</script>
</body>
</html>